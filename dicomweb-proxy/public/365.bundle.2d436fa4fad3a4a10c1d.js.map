{"version":3,"file":"365.bundle.2d436fa4fad3a4a10c1d.js","mappings":"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","sources":["webpack:///../../../node_modules/react-resize-detector/build/index.esm.js","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportImageScrollbar.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportOverlay.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportOrientationMarkers.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportImageSliceLoadingIndicator.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/CornerstoneOverlays.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/OHIFCornerstoneViewport.tsx"],"sourcesContent":["import*as React from'react';import {cloneElement,isValidElement,createRef,PureComponent,Component,forwardRef,useRef,useState,useEffect,useLayoutEffect}from'react';import {findDOMNode}from'react-dom';/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\n\nfunction isObject$3(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nvar isObject_1 = isObject$3;/** Detect free variable `global` from Node.js. */\n\nvar freeGlobal$1 = typeof commonjsGlobal == 'object' && commonjsGlobal && commonjsGlobal.Object === Object && commonjsGlobal;\n\nvar _freeGlobal = freeGlobal$1;var freeGlobal = _freeGlobal;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root$2 = freeGlobal || freeSelf || Function('return this')();\n\nvar _root = root$2;var root$1 = _root;\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now$1 = function() {\n  return root$1.Date.now();\n};\n\nvar now_1 = now$1;/** Used to match a single whitespace character. */\n\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex$1(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nvar _trimmedEndIndex = trimmedEndIndex$1;var trimmedEndIndex = _trimmedEndIndex;\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim$1(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nvar _baseTrim = baseTrim$1;var root = _root;\n\n/** Built-in value references. */\nvar Symbol$2 = root.Symbol;\n\nvar _Symbol = Symbol$2;var Symbol$1 = _Symbol;\n\n/** Used for built-in method references. */\nvar objectProto$1 = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto$1.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString$1 = objectProto$1.toString;\n\n/** Built-in value references. */\nvar symToStringTag$1 = Symbol$1 ? Symbol$1.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag$1(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag$1),\n      tag = value[symToStringTag$1];\n\n  try {\n    value[symToStringTag$1] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString$1.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag$1] = tag;\n    } else {\n      delete value[symToStringTag$1];\n    }\n  }\n  return result;\n}\n\nvar _getRawTag = getRawTag$1;/** Used for built-in method references. */\n\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString$1(value) {\n  return nativeObjectToString.call(value);\n}\n\nvar _objectToString = objectToString$1;var Symbol = _Symbol,\n    getRawTag = _getRawTag,\n    objectToString = _objectToString;\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag$1(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nvar _baseGetTag = baseGetTag$1;/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\n\nfunction isObjectLike$1(value) {\n  return value != null && typeof value == 'object';\n}\n\nvar isObjectLike_1 = isObjectLike$1;var baseGetTag = _baseGetTag,\n    isObjectLike = isObjectLike_1;\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol$1(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nvar isSymbol_1 = isSymbol$1;var baseTrim = _baseTrim,\n    isObject$2 = isObject_1,\n    isSymbol = isSymbol_1;\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber$1(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject$2(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject$2(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nvar toNumber_1 = toNumber$1;var isObject$1 = isObject_1,\n    now = now_1,\n    toNumber = toNumber_1;\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT$1 = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce$1(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT$1);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject$1(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nvar debounce_1 = debounce$1;var debounce = debounce_1,\n    isObject = isObject_1;\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nvar throttle_1 = throttle;var patchResizeHandler = function (resizeCallback, refreshMode, refreshRate, refreshOptions) {\r\n    switch (refreshMode) {\r\n        case 'debounce':\r\n            return debounce_1(resizeCallback, refreshRate, refreshOptions);\r\n        case 'throttle':\r\n            return throttle_1(resizeCallback, refreshRate, refreshOptions);\r\n        default:\r\n            return resizeCallback;\r\n    }\r\n};\r\nvar isFunction = function (fn) { return typeof fn === 'function'; };\r\nvar isSSR = function () { return typeof window === 'undefined'; };\r\nvar isDOMElement = function (element) { return element instanceof Element || element instanceof HTMLDocument; };\r\nvar createNotifier = function (onResize, setSize, handleWidth, handleHeight) {\r\n    return function (_a) {\r\n        var width = _a.width, height = _a.height;\r\n        setSize(function (prev) {\r\n            if (prev.width === width && prev.height === height) {\r\n                // skip if dimensions haven't changed\r\n                return prev;\r\n            }\r\n            if ((prev.width === width && !handleHeight) || (prev.height === height && !handleWidth)) {\r\n                // process `handleHeight/handleWidth` props\r\n                return prev;\r\n            }\r\n            if (onResize && isFunction(onResize)) {\r\n                onResize(width, height);\r\n            }\r\n            return { width: width, height: height };\r\n        });\r\n    };\r\n};var ResizeDetector = /** @class */ (function (_super) {\r\n    __extends(ResizeDetector, _super);\r\n    function ResizeDetector(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.cancelHandler = function () {\r\n            if (_this.resizeHandler && _this.resizeHandler.cancel) {\r\n                // cancel debounced handler\r\n                _this.resizeHandler.cancel();\r\n                _this.resizeHandler = null;\r\n            }\r\n        };\r\n        _this.attachObserver = function () {\r\n            var _a = _this.props, targetRef = _a.targetRef, observerOptions = _a.observerOptions;\r\n            if (isSSR()) {\r\n                return;\r\n            }\r\n            if (targetRef && targetRef.current) {\r\n                _this.targetRef.current = targetRef.current;\r\n            }\r\n            var element = _this.getElement();\r\n            if (!element) {\r\n                // can't find element to observe\r\n                return;\r\n            }\r\n            if (_this.observableElement && _this.observableElement === element) {\r\n                // element is already observed\r\n                return;\r\n            }\r\n            _this.observableElement = element;\r\n            _this.resizeObserver.observe(element, observerOptions);\r\n        };\r\n        _this.getElement = function () {\r\n            var _a = _this.props, querySelector = _a.querySelector, targetDomEl = _a.targetDomEl;\r\n            if (isSSR())\r\n                return null;\r\n            // in case we pass a querySelector\r\n            if (querySelector)\r\n                return document.querySelector(querySelector);\r\n            // in case we pass a DOM element\r\n            if (targetDomEl && isDOMElement(targetDomEl))\r\n                return targetDomEl;\r\n            // in case we pass a React ref using React.createRef()\r\n            if (_this.targetRef && isDOMElement(_this.targetRef.current))\r\n                return _this.targetRef.current;\r\n            // the worse case when we don't receive any information from the parent and the library doesn't add any wrappers\r\n            // we have to use a deprecated `findDOMNode` method in order to find a DOM element to attach to\r\n            var currentElement = findDOMNode(_this);\r\n            if (!currentElement)\r\n                return null;\r\n            var renderType = _this.getRenderType();\r\n            switch (renderType) {\r\n                case 'renderProp':\r\n                    return currentElement;\r\n                case 'childFunction':\r\n                    return currentElement;\r\n                case 'child':\r\n                    return currentElement;\r\n                case 'childArray':\r\n                    return currentElement;\r\n                default:\r\n                    return currentElement.parentElement;\r\n            }\r\n        };\r\n        _this.createResizeHandler = function (entries) {\r\n            var _a = _this.props, _b = _a.handleWidth, handleWidth = _b === void 0 ? true : _b, _c = _a.handleHeight, handleHeight = _c === void 0 ? true : _c, onResize = _a.onResize;\r\n            if (!handleWidth && !handleHeight)\r\n                return;\r\n            var notifyResize = createNotifier(onResize, _this.setState.bind(_this), handleWidth, handleHeight);\r\n            entries.forEach(function (entry) {\r\n                var _a = (entry && entry.contentRect) || {}, width = _a.width, height = _a.height;\r\n                var shouldSetSize = !_this.skipOnMount && !isSSR();\r\n                if (shouldSetSize) {\r\n                    notifyResize({ width: width, height: height });\r\n                }\r\n                _this.skipOnMount = false;\r\n            });\r\n        };\r\n        _this.getRenderType = function () {\r\n            var _a = _this.props, render = _a.render, children = _a.children;\r\n            if (isFunction(render)) {\r\n                // DEPRECATED. Use `Child Function Pattern` instead\r\n                return 'renderProp';\r\n            }\r\n            if (isFunction(children)) {\r\n                return 'childFunction';\r\n            }\r\n            if (isValidElement(children)) {\r\n                return 'child';\r\n            }\r\n            if (Array.isArray(children)) {\r\n                // DEPRECATED. Wrap children with a single parent\r\n                return 'childArray';\r\n            }\r\n            // DEPRECATED. Use `Child Function Pattern` instead\r\n            return 'parent';\r\n        };\r\n        var skipOnMount = props.skipOnMount, refreshMode = props.refreshMode, _a = props.refreshRate, refreshRate = _a === void 0 ? 1000 : _a, refreshOptions = props.refreshOptions;\r\n        _this.state = {\r\n            width: undefined,\r\n            height: undefined\r\n        };\r\n        _this.skipOnMount = skipOnMount;\r\n        _this.targetRef = createRef();\r\n        _this.observableElement = null;\r\n        if (isSSR()) {\r\n            return _this;\r\n        }\r\n        _this.resizeHandler = patchResizeHandler(_this.createResizeHandler, refreshMode, refreshRate, refreshOptions);\r\n        _this.resizeObserver = new window.ResizeObserver(_this.resizeHandler);\r\n        return _this;\r\n    }\r\n    ResizeDetector.prototype.componentDidMount = function () {\r\n        this.attachObserver();\r\n    };\r\n    ResizeDetector.prototype.componentDidUpdate = function () {\r\n        this.attachObserver();\r\n    };\r\n    ResizeDetector.prototype.componentWillUnmount = function () {\r\n        if (isSSR()) {\r\n            return;\r\n        }\r\n        this.resizeObserver.disconnect();\r\n        this.cancelHandler();\r\n    };\r\n    ResizeDetector.prototype.render = function () {\r\n        var _a = this.props, render = _a.render, children = _a.children, _b = _a.nodeType, WrapperTag = _b === void 0 ? 'div' : _b;\r\n        var _c = this.state, width = _c.width, height = _c.height;\r\n        var childProps = { width: width, height: height, targetRef: this.targetRef };\r\n        var renderType = this.getRenderType();\r\n        var typedChildren;\r\n        switch (renderType) {\r\n            case 'renderProp':\r\n                return render && render(childProps);\r\n            case 'childFunction':\r\n                typedChildren = children;\r\n                return typedChildren(childProps);\r\n            case 'child':\r\n                // @TODO bug prone logic\r\n                typedChildren = children;\r\n                if (typedChildren.type && typeof typedChildren.type === 'string') {\r\n                    // child is a native DOM elements such as div, span etc\r\n                    childProps.targetRef; var nativeProps = __rest(childProps, [\"targetRef\"]);\r\n                    return cloneElement(typedChildren, nativeProps);\r\n                }\r\n                // class or functional component otherwise\r\n                return cloneElement(typedChildren, childProps);\r\n            case 'childArray':\r\n                typedChildren = children;\r\n                return typedChildren.map(function (el) { return !!el && cloneElement(el, childProps); });\r\n            default:\r\n                return React.createElement(WrapperTag, null);\r\n        }\r\n    };\r\n    return ResizeDetector;\r\n}(PureComponent));function withResizeDetector(ComponentInner, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var ResizeDetectorHOC = /** @class */ (function (_super) {\r\n        __extends(ResizeDetectorHOC, _super);\r\n        function ResizeDetectorHOC() {\r\n            var _this = _super !== null && _super.apply(this, arguments) || this;\r\n            _this.ref = createRef();\r\n            return _this;\r\n        }\r\n        ResizeDetectorHOC.prototype.render = function () {\r\n            var _a = this.props, forwardedRef = _a.forwardedRef, rest = __rest(_a, [\"forwardedRef\"]);\r\n            var targetRef = forwardedRef !== null && forwardedRef !== void 0 ? forwardedRef : this.ref;\r\n            return (React.createElement(ResizeDetector, __assign({}, options, { targetRef: targetRef }),\r\n                React.createElement(ComponentInner, __assign({ targetRef: targetRef }, rest))));\r\n        };\r\n        return ResizeDetectorHOC;\r\n    }(Component));\r\n    function forwardRefWrapper(props, ref) {\r\n        return React.createElement(ResizeDetectorHOC, __assign({}, props, { forwardedRef: ref }));\r\n    }\r\n    var name = ComponentInner.displayName || ComponentInner.name;\r\n    forwardRefWrapper.displayName = \"withResizeDetector(\".concat(name, \")\");\r\n    return forwardRef(forwardRefWrapper);\r\n}var useEnhancedEffect = isSSR() ? useEffect : useLayoutEffect;\r\nfunction useResizeDetector(props) {\r\n    if (props === void 0) { props = {}; }\r\n    var _a = props.skipOnMount, skipOnMount = _a === void 0 ? false : _a, refreshMode = props.refreshMode, _b = props.refreshRate, refreshRate = _b === void 0 ? 1000 : _b, refreshOptions = props.refreshOptions, _c = props.handleWidth, handleWidth = _c === void 0 ? true : _c, _d = props.handleHeight, handleHeight = _d === void 0 ? true : _d, targetRef = props.targetRef, observerOptions = props.observerOptions, onResize = props.onResize;\r\n    var skipResize = useRef(skipOnMount);\r\n    var localRef = useRef(null);\r\n    var ref = (targetRef !== null && targetRef !== void 0 ? targetRef : localRef);\r\n    var resizeHandler = useRef();\r\n    var _e = useState({\r\n        width: undefined,\r\n        height: undefined\r\n    }), size = _e[0], setSize = _e[1];\r\n    useEnhancedEffect(function () {\r\n        if (isSSR()) {\r\n            return;\r\n        }\r\n        var notifyResize = createNotifier(onResize, setSize, handleWidth, handleHeight);\r\n        var resizeCallback = function (entries) {\r\n            if (!handleWidth && !handleHeight)\r\n                return;\r\n            entries.forEach(function (entry) {\r\n                var _a = (entry && entry.contentRect) || {}, width = _a.width, height = _a.height;\r\n                var shouldSetSize = !skipResize.current && !isSSR();\r\n                if (shouldSetSize) {\r\n                    notifyResize({ width: width, height: height });\r\n                }\r\n                skipResize.current = false;\r\n            });\r\n        };\r\n        resizeHandler.current = patchResizeHandler(resizeCallback, refreshMode, refreshRate, refreshOptions);\r\n        var resizeObserver = new window.ResizeObserver(resizeHandler.current);\r\n        if (ref.current) {\r\n            // Something wrong with typings here...\r\n            resizeObserver.observe(ref.current, observerOptions);\r\n        }\r\n        return function () {\r\n            resizeObserver.disconnect();\r\n            var patchedResizeHandler = resizeHandler.current;\r\n            if (patchedResizeHandler && patchedResizeHandler.cancel) {\r\n                patchedResizeHandler.cancel();\r\n            }\r\n        };\r\n    }, [refreshMode, refreshRate, refreshOptions, handleWidth, handleHeight, onResize, observerOptions, ref.current]);\r\n    return __assign({ ref: ref }, size);\r\n}export{ResizeDetector as default,useResizeDetector,withResizeDetector};//# sourceMappingURL=index.esm.js.map\n","import React, { useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Enums, Types, utilities } from '@cornerstonejs/core';\r\nimport { utilities as csToolsUtils } from '@cornerstonejs/tools';\r\nimport { ImageScrollbar } from '@ohif/ui';\r\n\r\nfunction CornerstoneImageScrollbar({\r\n  viewportData,\r\n  viewportIndex,\r\n  element,\r\n  imageSliceData,\r\n  setImageSliceData,\r\n  scrollbarHeight,\r\n  servicesManager,\r\n}) {\r\n  const { CineService, CornerstoneViewportService } = servicesManager.services;\r\n\r\n  const onImageScrollbarChange = (imageIndex, viewportIndex) => {\r\n    const viewportInfo = CornerstoneViewportService.getViewportInfoByIndex(\r\n      viewportIndex\r\n    );\r\n\r\n    const viewportId = viewportInfo.getViewportId();\r\n    const viewport = CornerstoneViewportService.getCornerstoneViewport(\r\n      viewportId\r\n    );\r\n\r\n    const { isCineEnabled } = CineService.getState();\r\n\r\n    if (isCineEnabled) {\r\n      // on image scrollbar change, stop the CINE if it is playing\r\n      CineService.stopClip(element);\r\n      CineService.setCine({ id: viewportIndex, isPlaying: false });\r\n    }\r\n\r\n    csToolsUtils.jumpToSlice(viewport.element, {\r\n      imageIndex,\r\n      debounceLoading: true,\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!viewportData) {\r\n      return;\r\n    }\r\n\r\n    const viewport = CornerstoneViewportService.getCornerstoneViewportByIndex(\r\n      viewportIndex\r\n    );\r\n\r\n    if (!viewport) {\r\n      return;\r\n    }\r\n\r\n    if (viewportData.viewportType === Enums.ViewportType.STACK) {\r\n      const imageIndex = viewport.getCurrentImageIdIndex();\r\n\r\n      setImageSliceData({\r\n        imageIndex: imageIndex,\r\n        numberOfSlices: viewportData.data.imageIds.length,\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    if (viewportData.viewportType === Enums.ViewportType.ORTHOGRAPHIC) {\r\n      const sliceData = utilities.getImageSliceDataForVolumeViewport(\r\n        viewport as Types.IVolumeViewport\r\n      );\r\n\r\n      if (!sliceData) {\r\n        return;\r\n      }\r\n\r\n      const { imageIndex, numberOfSlices } = sliceData;\r\n      setImageSliceData({ imageIndex, numberOfSlices });\r\n    }\r\n  }, [viewportIndex, viewportData]);\r\n\r\n  useEffect(() => {\r\n    if (viewportData?.viewportType !== Enums.ViewportType.STACK) {\r\n      return;\r\n    }\r\n\r\n    const updateStackIndex = event => {\r\n      const { newImageIdIndex } = event.detail;\r\n      // find the index of imageId in the imageIds\r\n      setImageSliceData({\r\n        imageIndex: newImageIdIndex,\r\n        numberOfSlices: viewportData.data.imageIds.length,\r\n      });\r\n    };\r\n\r\n    element.addEventListener(\r\n      Enums.Events.STACK_VIEWPORT_SCROLL,\r\n      updateStackIndex\r\n    );\r\n\r\n    return () => {\r\n      element.removeEventListener(\r\n        Enums.Events.STACK_VIEWPORT_SCROLL,\r\n        updateStackIndex\r\n      );\r\n    };\r\n  }, [viewportData, element]);\r\n\r\n  useEffect(() => {\r\n    if (viewportData?.viewportType !== Enums.ViewportType.ORTHOGRAPHIC) {\r\n      return;\r\n    }\r\n\r\n    const updateVolumeIndex = event => {\r\n      const { imageIndex, numberOfSlices } = event.detail;\r\n      // find the index of imageId in the imageIds\r\n      setImageSliceData({ imageIndex, numberOfSlices });\r\n    };\r\n\r\n    element.addEventListener(Enums.Events.VOLUME_NEW_IMAGE, updateVolumeIndex);\r\n\r\n    return () => {\r\n      element.removeEventListener(\r\n        Enums.Events.VOLUME_NEW_IMAGE,\r\n        updateVolumeIndex\r\n      );\r\n    };\r\n  }, [viewportData, element]);\r\n\r\n  return (\r\n    <ImageScrollbar\r\n      onChange={evt => onImageScrollbarChange(evt, viewportIndex)}\r\n      max={\r\n        imageSliceData.numberOfSlices ? imageSliceData.numberOfSlices - 1 : 0\r\n      }\r\n      height={scrollbarHeight}\r\n      value={imageSliceData.imageIndex}\r\n    />\r\n  );\r\n}\r\n\r\nCornerstoneImageScrollbar.propTypes = {\r\n  viewportData: PropTypes.object,\r\n  viewportIndex: PropTypes.number.isRequired,\r\n  element: PropTypes.instanceOf(Element),\r\n  scrollbarHeight: PropTypes.string,\r\n  imageSliceData: PropTypes.object.isRequired,\r\n  setImageSliceData: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default CornerstoneImageScrollbar;\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport { vec3 } from 'gl-matrix';\r\nimport PropTypes from 'prop-types';\r\nimport { metaData, Enums, utilities } from '@cornerstonejs/core';\r\nimport { ViewportOverlay } from '@ohif/ui';\r\n\r\nconst EPSILON = 1e-4;\r\n\r\nfunction CornerstoneViewportOverlay({\r\n  element,\r\n  viewportData,\r\n  imageSliceData,\r\n  viewportIndex,\r\n  servicesManager,\r\n}) {\r\n  const {\r\n    CornerstoneViewportService,\r\n    ToolBarService,\r\n  } = servicesManager.services;\r\n  const [voi, setVOI] = useState({ windowCenter: null, windowWidth: null });\r\n  const [scale, setScale] = useState(1);\r\n  const [activeTools, setActiveTools] = useState([]);\r\n\r\n  /**\r\n   * Initial toolbar state\r\n   */\r\n  useEffect(() => {\r\n    setActiveTools(ToolBarService.getActiveTools());\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    const { unsubscribe } = ToolBarService.subscribe(\r\n      ToolBarService.EVENTS.TOOL_BAR_STATE_MODIFIED,\r\n      () => {\r\n        if (!isMounted) {\r\n          return;\r\n        }\r\n\r\n        setActiveTools(ToolBarService.getActiveTools());\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      isMounted = false;\r\n      unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  /**\r\n   * Updating the VOI when the viewport changes its voi\r\n   */\r\n  useEffect(() => {\r\n    const updateVOI = eventDetail => {\r\n      const { range } = eventDetail.detail;\r\n\r\n      if (!range) {\r\n        return;\r\n      }\r\n\r\n      const { lower, upper } = range;\r\n      const { windowWidth, windowCenter } = utilities.windowLevel.toWindowLevel(\r\n        lower,\r\n        upper\r\n      );\r\n\r\n      setVOI({ windowCenter, windowWidth });\r\n    };\r\n\r\n    element.addEventListener(Enums.Events.VOI_MODIFIED, updateVOI);\r\n\r\n    return () => {\r\n      element.removeEventListener(Enums.Events.VOI_MODIFIED, updateVOI);\r\n    };\r\n  }, [viewportIndex, viewportData, voi, element]);\r\n\r\n  /**\r\n   * Updating the scale when the viewport changes its zoom\r\n   */\r\n  useEffect(() => {\r\n    const updateScale = eventDetail => {\r\n      const { previousCamera, camera } = eventDetail.detail;\r\n\r\n      if (\r\n        previousCamera.parallelScale !== camera.parallelScale ||\r\n        previousCamera.scale !== camera.scale\r\n      ) {\r\n        const viewport = CornerstoneViewportService.getCornerstoneViewportByIndex(\r\n          viewportIndex\r\n        );\r\n\r\n        if (!viewport) {\r\n          return;\r\n        }\r\n\r\n        const imageData = viewport.getImageData();\r\n\r\n        if (!imageData) {\r\n          return;\r\n        }\r\n\r\n        if (camera.scale) {\r\n          setScale(camera.scale);\r\n          return;\r\n        }\r\n\r\n        const { spacing } = imageData;\r\n        // convert parallel scale to scale\r\n        const scale =\r\n          (element.clientHeight * spacing[0] * 0.5) / camera.parallelScale;\r\n        setScale(scale);\r\n      }\r\n    };\r\n\r\n    element.addEventListener(Enums.Events.CAMERA_MODIFIED, updateScale);\r\n\r\n    return () => {\r\n      element.removeEventListener(Enums.Events.CAMERA_MODIFIED, updateScale);\r\n    };\r\n  }, [viewportIndex, viewportData]);\r\n\r\n  const getTopLeftContent = useCallback(() => {\r\n    const { windowWidth, windowCenter } = voi;\r\n\r\n    if (activeTools.includes('WindowLevel')) {\r\n      if (typeof windowCenter !== 'number' || typeof windowWidth !== 'number') {\r\n        return null;\r\n      }\r\n\r\n      return (\r\n        <div className=\"flex flex-row\">\r\n          <span className=\"mr-1\">W:</span>\r\n          <span className=\"ml-1 mr-2 font-light\">{windowWidth.toFixed(0)}</span>\r\n          <span className=\"mr-1\">L:</span>\r\n          <span className=\"ml-1 font-light\">{windowCenter.toFixed(0)}</span>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (activeTools.includes('Zoom')) {\r\n      return (\r\n        <div className=\"flex flex-row\">\r\n          <span className=\"mr-1\">Zoom:</span>\r\n          <span className=\"font-light\">{scale.toFixed(2)}x</span>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return null;\r\n  }, [voi, scale, activeTools]);\r\n\r\n  const getTopRightContent = useCallback(() => {\r\n    const { imageIndex, numberOfSlices } = imageSliceData;\r\n    if (!viewportData) {\r\n      return;\r\n    }\r\n\r\n    let instanceNumber;\r\n\r\n    if (viewportData.viewportType === Enums.ViewportType.STACK) {\r\n      instanceNumber = _getInstanceNumberFromStack(viewportData, imageIndex);\r\n\r\n      if (!instanceNumber) {\r\n        return null;\r\n      }\r\n    } else if (viewportData.viewportType === Enums.ViewportType.ORTHOGRAPHIC) {\r\n      instanceNumber = _getInstanceNumberFromVolume(\r\n        viewportData,\r\n        imageIndex,\r\n        viewportIndex,\r\n        CornerstoneViewportService\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"flex flex-row\">\r\n        <span className=\"mr-1\">I:</span>\r\n        <span className=\"font-light\">\r\n          {instanceNumber !== undefined\r\n            ? `${instanceNumber} (${imageIndex + 1}/${numberOfSlices})`\r\n            : `${imageIndex + 1}/${numberOfSlices}`}\r\n        </span>\r\n      </div>\r\n    );\r\n  }, [imageSliceData, viewportData, viewportIndex]);\r\n\r\n  if (!viewportData) {\r\n    return null;\r\n  }\r\n\r\n  const ohifViewport = CornerstoneViewportService.getViewportInfoByIndex(\r\n    viewportIndex\r\n  );\r\n\r\n  if (!ohifViewport) {\r\n    return null;\r\n  }\r\n\r\n  const backgroundColor = ohifViewport.getViewportOptions().background;\r\n\r\n  // Todo: probably this can be done in a better way in which we identify bright\r\n  // background\r\n  const isLight = backgroundColor\r\n    ? utilities.isEqual(backgroundColor, [1, 1, 1])\r\n    : false;\r\n\r\n  return (\r\n    <ViewportOverlay\r\n      topLeft={getTopLeftContent()}\r\n      topRight={getTopRightContent()}\r\n      color={isLight && 'text-[#0944B3]'}\r\n    />\r\n  );\r\n}\r\n\r\nfunction _getInstanceNumberFromStack(viewportData, imageIndex) {\r\n  const imageIds = viewportData.data.imageIds;\r\n  const imageId = imageIds[imageIndex];\r\n\r\n  if (!imageId) {\r\n    return;\r\n  }\r\n\r\n  const generalImageModule = metaData.get('generalImageModule', imageId) || {};\r\n  const { instanceNumber } = generalImageModule;\r\n\r\n  const stackSize = imageIds.length;\r\n\r\n  if (stackSize <= 1) {\r\n    return;\r\n  }\r\n\r\n  return parseInt(instanceNumber);\r\n}\r\n\r\n// Since volume viewports can be in any view direction, they can render\r\n// a reconstructed image which don't have imageIds; therefore, no instance and instanceNumber\r\n// Here we check if viewport is in the acquisition direction and if so, we get the instanceNumber\r\nfunction _getInstanceNumberFromVolume(\r\n  viewportData,\r\n  imageIndex,\r\n  viewportIndex,\r\n  CornerstoneViewportService\r\n) {\r\n  const volumes = viewportData.volumes;\r\n\r\n  // Todo: support fusion of acquisition plane which has instanceNumber\r\n  if (!volumes || volumes.length > 1) {\r\n    return;\r\n  }\r\n\r\n  const volume = volumes[0];\r\n  const { direction, imageIds } = volume;\r\n\r\n  const cornerstoneViewport = CornerstoneViewportService.getCornerstoneViewportByIndex(\r\n    viewportIndex\r\n  );\r\n\r\n  if (!cornerstoneViewport) {\r\n    return;\r\n  }\r\n\r\n  const camera = cornerstoneViewport.getCamera();\r\n  const { viewPlaneNormal } = camera;\r\n  // checking if camera is looking at the acquisition plane (defined by the direction on the volume)\r\n\r\n  const scanAxisNormal = direction.slice(6, 9);\r\n\r\n  // check if viewPlaneNormal is parallel to scanAxisNormal\r\n  const cross = vec3.cross(vec3.create(), viewPlaneNormal, scanAxisNormal);\r\n  const isAcquisitionPlane = vec3.length(cross) < EPSILON;\r\n\r\n  if (isAcquisitionPlane) {\r\n    const imageId = imageIds[imageIndex];\r\n\r\n    if (!imageId) {\r\n      return {};\r\n    }\r\n\r\n    const { instanceNumber } =\r\n      metaData.get('generalImageModule', imageId) || {};\r\n    return parseInt(instanceNumber);\r\n  }\r\n}\r\n\r\nCornerstoneViewportOverlay.propTypes = {\r\n  viewportData: PropTypes.object,\r\n  imageIndex: PropTypes.number,\r\n  viewportIndex: PropTypes.number,\r\n};\r\n\r\nexport default CornerstoneViewportOverlay;\r\n","import React, { useEffect, useState, useMemo } from 'react';\r\nimport classNames from 'classnames';\r\nimport {\r\n  metaData,\r\n  Enums,\r\n  Types,\r\n  getEnabledElement,\r\n  utilities as csUtils,\r\n} from '@cornerstonejs/core';\r\nimport { utilities } from '@cornerstonejs/tools';\r\nimport PropTypes from 'prop-types';\r\nimport { vec3 } from 'gl-matrix';\r\n\r\nimport './ViewportOrientationMarkers.css';\r\n\r\nconst {\r\n  getOrientationStringLPS,\r\n  invertOrientationStringLPS,\r\n} = utilities.orientation;\r\n\r\nfunction ViewportOrientationMarkers({\r\n  element,\r\n  viewportData,\r\n  imageSliceData,\r\n  viewportIndex,\r\n  servicesManager,\r\n  orientationMarkers = ['top', 'left'],\r\n}) {\r\n  // Rotation is in degrees\r\n  const [rotation, setRotation] = useState(0);\r\n  const [flipHorizontal, setFlipHorizontal] = useState(false);\r\n  const [flipVertical, setFlipVertical] = useState(false);\r\n  const { CornerstoneViewportService } = servicesManager.services;\r\n\r\n  useEffect(() => {\r\n    const cameraModifiedListener = (\r\n      evt: Types.EventTypes.CameraModifiedEvent\r\n    ) => {\r\n      const { rotation, previousCamera, camera } = evt.detail;\r\n\r\n      if (rotation !== undefined) {\r\n        setRotation(rotation);\r\n      }\r\n\r\n      if (\r\n        camera.flipHorizontal !== undefined &&\r\n        previousCamera.flipHorizontal !== camera.flipHorizontal\r\n      ) {\r\n        setFlipHorizontal(camera.flipHorizontal);\r\n      }\r\n\r\n      if (\r\n        camera.flipVertical !== undefined &&\r\n        previousCamera.flipVertical !== camera.flipVertical\r\n      ) {\r\n        setFlipVertical(camera.flipVertical);\r\n      }\r\n    };\r\n\r\n    element.addEventListener(\r\n      Enums.Events.CAMERA_MODIFIED,\r\n      cameraModifiedListener\r\n    );\r\n\r\n    return () => {\r\n      element.removeEventListener(\r\n        Enums.Events.CAMERA_MODIFIED,\r\n        cameraModifiedListener\r\n      );\r\n    };\r\n  }, []);\r\n\r\n  const markers = useMemo(() => {\r\n    if (!viewportData) {\r\n      return '';\r\n    }\r\n\r\n    let rowCosines, columnCosines;\r\n    if (viewportData.viewportType === 'stack') {\r\n      const imageIndex = imageSliceData.imageIndex;\r\n      const imageId = viewportData.data.imageIds?.[imageIndex];\r\n\r\n      // Workaround for below TODO stub\r\n      if (!imageId) {\r\n        return false;\r\n      }\r\n\r\n      ({ rowCosines, columnCosines } =\r\n        metaData.get('imagePlaneModule', imageId) || {});\r\n    } else {\r\n      if (!element || !getEnabledElement(element)) {\r\n        return '';\r\n      }\r\n\r\n      const { viewport } = getEnabledElement(element);\r\n      const { viewUp, viewPlaneNormal } = viewport.getCamera();\r\n\r\n      const viewRight = vec3.create();\r\n      vec3.cross(viewRight, viewUp, viewPlaneNormal);\r\n\r\n      columnCosines = [-viewUp[0], -viewUp[1], -viewUp[2]];\r\n      rowCosines = viewRight;\r\n    }\r\n\r\n    if (!rowCosines || !columnCosines || rotation === undefined) {\r\n      return '';\r\n    }\r\n\r\n    const markers = _getOrientationMarkers(\r\n      rowCosines,\r\n      columnCosines,\r\n      rotation,\r\n      flipVertical,\r\n      flipHorizontal\r\n    );\r\n\r\n    const ohifViewport = CornerstoneViewportService.getViewportInfoByIndex(\r\n      viewportIndex\r\n    );\r\n\r\n    const backgroundColor = ohifViewport.getViewportOptions().background;\r\n\r\n    // Todo: probably this can be done in a better way in which we identify bright\r\n    // background\r\n    const isLight = backgroundColor\r\n      ? csUtils.isEqual(backgroundColor, [1, 1, 1])\r\n      : false;\r\n\r\n    return orientationMarkers.map((m, index) => (\r\n      <div\r\n        className={classNames(\r\n          `${m}-mid orientation-marker`,\r\n          isLight ? 'text-[#726F7E]' : 'text-[#ccc]'\r\n        )}\r\n        key={`${m}-mid orientation-marker`}\r\n      >\r\n        <div className=\"orientation-marker-value\">{markers[m]}</div>\r\n      </div>\r\n    ));\r\n  }, [\r\n    viewportData,\r\n    imageSliceData,\r\n    rotation,\r\n    flipVertical,\r\n    flipHorizontal,\r\n    orientationMarkers,\r\n    element,\r\n  ]);\r\n\r\n  return <div className=\"ViewportOrientationMarkers noselect\">{markers}</div>;\r\n}\r\n\r\nViewportOrientationMarkers.propTypes = {\r\n  percentComplete: PropTypes.number,\r\n  error: PropTypes.object,\r\n};\r\n\r\nViewportOrientationMarkers.defaultProps = {\r\n  percentComplete: 0,\r\n  error: null,\r\n};\r\n\r\n/**\r\n *\r\n * Computes the orientation labels on a Cornerstone-enabled Viewport element\r\n * when the viewport settings change (e.g. when a horizontal flip or a rotation occurs)\r\n *\r\n * @param {*} rowCosines\r\n * @param {*} columnCosines\r\n * @param {*} rotation in degrees\r\n * @returns\r\n */\r\nfunction _getOrientationMarkers(\r\n  rowCosines,\r\n  columnCosines,\r\n  rotation,\r\n  flipVertical,\r\n  flipHorizontal\r\n) {\r\n  const rowString = getOrientationStringLPS(rowCosines);\r\n  const columnString = getOrientationStringLPS(columnCosines);\r\n  const oppositeRowString = invertOrientationStringLPS(rowString);\r\n  const oppositeColumnString = invertOrientationStringLPS(columnString);\r\n\r\n  const markers = {\r\n    top: oppositeColumnString,\r\n    left: oppositeRowString,\r\n    right: rowString,\r\n    bottom: columnString,\r\n  };\r\n\r\n  // If any vertical or horizontal flips are applied, change the orientation strings ahead of\r\n  // the rotation applications\r\n  if (flipVertical) {\r\n    markers.top = invertOrientationStringLPS(markers.top);\r\n    markers.bottom = invertOrientationStringLPS(markers.bottom);\r\n  }\r\n\r\n  if (flipHorizontal) {\r\n    markers.left = invertOrientationStringLPS(markers.left);\r\n    markers.right = invertOrientationStringLPS(markers.right);\r\n  }\r\n\r\n  // Swap the labels accordingly if the viewport has been rotated\r\n  // This could be done in a more complex way for intermediate rotation values (e.g. 45 degrees)\r\n  if (rotation === 90 || rotation === -270) {\r\n    return {\r\n      top: markers.left,\r\n      left: invertOrientationStringLPS(markers.top),\r\n      right: invertOrientationStringLPS(markers.bottom),\r\n      bottom: markers.right, // left\r\n    };\r\n  } else if (rotation === -90 || rotation === 270) {\r\n    return {\r\n      top: invertOrientationStringLPS(markers.left),\r\n      left: markers.top,\r\n      bottom: markers.left,\r\n      right: markers.bottom,\r\n    };\r\n  } else if (rotation === 180 || rotation === -180) {\r\n    return {\r\n      top: invertOrientationStringLPS(markers.top),\r\n      left: invertOrientationStringLPS(markers.left),\r\n      bottom: invertOrientationStringLPS(markers.bottom),\r\n      right: invertOrientationStringLPS(markers.right),\r\n    };\r\n  }\r\n\r\n  return markers;\r\n}\r\n\r\nexport default ViewportOrientationMarkers;\r\n","import React, { useEffect, useState, useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Enums } from '@cornerstonejs/core';\r\n\r\nfunction ViewportImageSliceLoadingIndicator({ viewportData, element }) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(false);\r\n\r\n  const loadIndicatorRef = useRef(null);\r\n  const imageIdToBeLoaded = useRef(null);\r\n\r\n  const setLoadingState = evt => {\r\n    clearTimeout(loadIndicatorRef.current);\r\n\r\n    loadIndicatorRef.current = setTimeout(() => {\r\n      setLoading(true);\r\n    }, 50);\r\n  };\r\n\r\n  const setFinishLoadingState = evt => {\r\n    clearTimeout(loadIndicatorRef.current);\r\n\r\n    setLoading(false);\r\n  };\r\n\r\n  const setErrorState = evt => {\r\n    clearTimeout(loadIndicatorRef.current);\r\n\r\n    if (imageIdToBeLoaded.current === evt.detail.imageId) {\r\n      setError(evt.detail.error);\r\n      imageIdToBeLoaded.current = null;\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    element.addEventListener(\r\n      Enums.Events.STACK_VIEWPORT_SCROLL,\r\n      setLoadingState\r\n    );\r\n    element.addEventListener(Enums.Events.IMAGE_LOAD_ERROR, setErrorState);\r\n    element.addEventListener(\r\n      Enums.Events.STACK_NEW_IMAGE,\r\n      setFinishLoadingState\r\n    );\r\n\r\n    return () => {\r\n      element.removeEventListener(\r\n        Enums.Events.STACK_VIEWPORT_SCROLL,\r\n        setLoadingState\r\n      );\r\n\r\n      element.removeEventListener(\r\n        Enums.Events.STACK_NEW_IMAGE,\r\n        setFinishLoadingState\r\n      );\r\n\r\n      element.removeEventListener(Enums.Events.IMAGE_LOAD_ERROR, setErrorState);\r\n    };\r\n  }, [element, viewportData]);\r\n\r\n  if (error) {\r\n    return (\r\n      <>\r\n        <div className=\"bg-black opacity-50 absolute h-full w-full top-0 left-0\">\r\n          <div className=\"flex transparent items-center justify-center w-full h-full\">\r\n            <p className=\"text-primary-light text-xl font-light\">\r\n              <h4>Error Loading Image</h4>\r\n              <p>An error has occurred.</p>\r\n              <p>{error}</p>\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      // IMPORTANT: we need to use the pointer-events-none class to prevent the loading indicator from\r\n      // interacting with the mouse, since scrolling should propagate to the viewport underneath\r\n      <div className=\"pointer-events-none bg-black opacity-50 absolute h-full w-full top-0 left-0\">\r\n        <div className=\"flex transparent items-center justify-center w-full h-full\">\r\n          <p className=\"text-primary-light text-xl font-light\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nViewportImageSliceLoadingIndicator.propTypes = {\r\n  percentComplete: PropTypes.number,\r\n  error: PropTypes.object,\r\n  element: PropTypes.object,\r\n};\r\n\r\nViewportImageSliceLoadingIndicator.defaultProps = {\r\n  percentComplete: 0,\r\n  error: null,\r\n};\r\n\r\nexport default ViewportImageSliceLoadingIndicator;\r\n","import React, { useEffect, useState } from 'react';\r\n\r\nimport ViewportImageScrollbar from './ViewportImageScrollbar';\r\nimport ViewportOverlay from './ViewportOverlay';\r\nimport ViewportOrientationMarkers from './ViewportOrientationMarkers';\r\nimport ViewportImageSliceLoadingIndicator from './ViewportImageSliceLoadingIndicator';\r\n\r\nfunction CornerstoneOverlays(props) {\r\n  const { viewportIndex, element, scrollbarHeight, servicesManager } = props;\r\n  const { CornerstoneViewportService } = servicesManager.services;\r\n  const [imageSliceData, setImageSliceData] = useState({\r\n    imageIndex: 0,\r\n    numberOfSlices: 0,\r\n  });\r\n  const [viewportData, setViewportData] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const { unsubscribe } = CornerstoneViewportService.subscribe(\r\n      CornerstoneViewportService.EVENTS.VIEWPORT_DATA_CHANGED,\r\n      props => {\r\n        if (props.viewportIndex !== viewportIndex) {\r\n          return;\r\n        }\r\n\r\n        setViewportData(props.viewportData);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [viewportIndex]);\r\n\r\n  if (!element) {\r\n    return null;\r\n  }\r\n\r\n  if (viewportData) {\r\n    const viewportInfo = CornerstoneViewportService.getViewportInfoByIndex(\r\n      viewportIndex\r\n    );\r\n\r\n    if (viewportInfo?.viewportOptions?.customViewportProps?.hideOverlays) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"noselect\">\r\n      <ViewportImageScrollbar\r\n        viewportIndex={viewportIndex}\r\n        viewportData={viewportData}\r\n        element={element}\r\n        imageSliceData={imageSliceData}\r\n        setImageSliceData={setImageSliceData}\r\n        scrollbarHeight={scrollbarHeight}\r\n        servicesManager={servicesManager}\r\n      />\r\n      <ViewportOverlay\r\n        imageSliceData={imageSliceData}\r\n        viewportData={viewportData}\r\n        viewportIndex={viewportIndex}\r\n        servicesManager={servicesManager}\r\n        element={element}\r\n      />\r\n      <ViewportImageSliceLoadingIndicator\r\n        viewportData={viewportData}\r\n        element={element}\r\n      />\r\n      <ViewportOrientationMarkers\r\n        imageSliceData={imageSliceData}\r\n        element={element}\r\n        viewportData={viewportData}\r\n        servicesManager={servicesManager}\r\n        viewportIndex={viewportIndex}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CornerstoneOverlays;\r\n","import React, { useEffect, useRef, useCallback, useState } from 'react';\r\nimport ReactResizeDetector from 'react-resize-detector';\r\nimport PropTypes from 'prop-types';\r\nimport * as cs3DTools from '@cornerstonejs/tools';\r\nimport {\r\n  Enums,\r\n  eventTarget,\r\n  getEnabledElement,\r\n  StackViewport,\r\n  utilities as csUtils,\r\n  CONSTANTS,\r\n} from '@cornerstonejs/core';\r\n\r\nimport { setEnabledElement } from '../state';\r\n\r\nimport './OHIFCornerstoneViewport.css';\r\nimport CornerstoneOverlays from './Overlays/CornerstoneOverlays';\r\nimport {\r\n  IStackViewport,\r\n  IVolumeViewport,\r\n} from '@cornerstonejs/core/dist/esm/types';\r\nimport getSOPInstanceAttributes from '../utils/measurementServiceMappings/utils/getSOPInstanceAttributes';\r\n\r\nconst STACK = 'stack';\r\n\r\nfunction areEqual(prevProps, nextProps) {\r\n  if (nextProps.needsRerendering) {\r\n    return false;\r\n  }\r\n\r\n  if (prevProps.displaySets.length !== nextProps.displaySets.length) {\r\n    return false;\r\n  }\r\n\r\n  if (\r\n    prevProps.viewportOptions.orientation !==\r\n    nextProps.viewportOptions.orientation\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  if (\r\n    prevProps.viewportOptions.toolGroupId !==\r\n    nextProps.viewportOptions.toolGroupId\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  if (\r\n    prevProps.viewportOptions.viewportType !==\r\n    nextProps.viewportOptions.viewportType\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  const prevDisplaySets = prevProps.displaySets;\r\n  const nextDisplaySets = nextProps.displaySets;\r\n\r\n  if (prevDisplaySets.length !== nextDisplaySets.length) {\r\n    return false;\r\n  }\r\n\r\n  for (let i = 0; i < prevDisplaySets.length; i++) {\r\n    const prevDisplaySet = prevDisplaySets[i];\r\n\r\n    const foundDisplaySet = nextDisplaySets.find(\r\n      nextDisplaySet =>\r\n        nextDisplaySet.displaySetInstanceUID ===\r\n        prevDisplaySet.displaySetInstanceUID\r\n    );\r\n\r\n    if (!foundDisplaySet) {\r\n      return false;\r\n    }\r\n\r\n    // check they contain the same image\r\n    if (foundDisplaySet.images?.length !== prevDisplaySet.images?.length) {\r\n      return false;\r\n    }\r\n\r\n    // check if their imageIds are the same\r\n    if (foundDisplaySet.images?.length) {\r\n      for (let j = 0; j < foundDisplaySet.images.length; j++) {\r\n        if (\r\n          foundDisplaySet.images[j].imageId !== prevDisplaySet.images[j].imageId\r\n        ) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n// Todo: This should be done with expose of internal API similar to react-vtkjs-viewport\r\n// Then we don't need to worry about the re-renders if the props change.\r\nconst OHIFCornerstoneViewport = React.memo(props => {\r\n  const {\r\n    viewportIndex,\r\n    displaySets,\r\n    dataSource,\r\n    viewportOptions,\r\n    displaySetOptions,\r\n    servicesManager,\r\n    onElementEnabled,\r\n    onElementDisabled,\r\n    // Note: you SHOULD NOT use the initialImageIdOrIndex for manipulation\r\n    // of the imageData in the OHIFCornerstoneViewport. This prop is used\r\n    // to set the initial state of the viewport's first image to render\r\n    initialImageIndex,\r\n  } = props;\r\n\r\n  const [scrollbarHeight, setScrollbarHeight] = useState('100px');\r\n\r\n  const elementRef = useRef();\r\n\r\n  const {\r\n    MeasurementService,\r\n    DisplaySetService,\r\n    ToolBarService,\r\n    ToolGroupService,\r\n    SyncGroupService,\r\n    CornerstoneViewportService,\r\n    CornerstoneCacheService,\r\n    ViewportGridService,\r\n  } = servicesManager.services;\r\n\r\n  // useCallback for scroll bar height calculation\r\n  const setImageScrollBarHeight = useCallback(() => {\r\n    const scrollbarHeight = `${elementRef.current.clientHeight - 20}px`;\r\n    setScrollbarHeight(scrollbarHeight);\r\n  }, [elementRef]);\r\n\r\n  // useCallback for onResize\r\n  const onResize = useCallback(() => {\r\n    if (elementRef.current) {\r\n      CornerstoneViewportService.resize();\r\n      setImageScrollBarHeight();\r\n    }\r\n  }, [elementRef]);\r\n\r\n  const cleanUpServices = useCallback(() => {\r\n    const viewportInfo = CornerstoneViewportService.getViewportInfoByIndex(\r\n      viewportIndex\r\n    );\r\n\r\n    if (!viewportInfo) {\r\n      return;\r\n    }\r\n\r\n    const viewportId = viewportInfo.getViewportId();\r\n    const renderingEngineId = viewportInfo.getRenderingEngineId();\r\n    const syncGroups = viewportInfo.getSyncGroups();\r\n\r\n    ToolGroupService.removeViewportFromToolGroup(viewportId, renderingEngineId);\r\n\r\n    SyncGroupService.removeViewportFromSyncGroup(\r\n      viewportId,\r\n      renderingEngineId,\r\n      syncGroups\r\n    );\r\n  }, [viewportIndex, viewportOptions.viewportId]);\r\n\r\n  const elementEnabledHandler = useCallback(\r\n    evt => {\r\n      // check this is this element reference and return early if doesn't match\r\n      if (evt.detail.element !== elementRef.current) {\r\n        return;\r\n      }\r\n\r\n      const { viewportId, element } = evt.detail;\r\n      const viewportInfo = CornerstoneViewportService.getViewportInfo(\r\n        viewportId\r\n      );\r\n      const viewportIndex = viewportInfo.getViewportIndex();\r\n\r\n      setEnabledElement(viewportIndex, element);\r\n\r\n      const renderingEngineId = viewportInfo.getRenderingEngineId();\r\n      const toolGroupId = viewportInfo.getToolGroupId();\r\n      const syncGroups = viewportInfo.getSyncGroups();\r\n\r\n      ToolGroupService.addViewportToToolGroup(\r\n        viewportId,\r\n        renderingEngineId,\r\n        toolGroupId\r\n      );\r\n\r\n      SyncGroupService.addViewportToSyncGroup(\r\n        viewportId,\r\n        renderingEngineId,\r\n        syncGroups\r\n      );\r\n\r\n      if (onElementEnabled) {\r\n        onElementEnabled(evt);\r\n      }\r\n    },\r\n    [viewportIndex, onElementEnabled, ToolGroupService]\r\n  );\r\n\r\n  // disable the element upon unmounting\r\n  useEffect(() => {\r\n    CornerstoneViewportService.enableViewport(\r\n      viewportIndex,\r\n      viewportOptions,\r\n      elementRef.current\r\n    );\r\n\r\n    eventTarget.addEventListener(\r\n      Enums.Events.ELEMENT_ENABLED,\r\n      elementEnabledHandler\r\n    );\r\n\r\n    setImageScrollBarHeight();\r\n\r\n    return () => {\r\n      cleanUpServices();\r\n\r\n      CornerstoneViewportService.disableElement(viewportIndex);\r\n\r\n      if (onElementDisabled) {\r\n        const viewportInfo = CornerstoneViewportService.getViewportInfoByIndex(\r\n          viewportIndex\r\n        );\r\n\r\n        onElementDisabled(viewportInfo);\r\n      }\r\n\r\n      eventTarget.removeEventListener(\r\n        Enums.Events.ELEMENT_ENABLED,\r\n        elementEnabledHandler\r\n      );\r\n    };\r\n  }, []);\r\n\r\n  // subscribe to displaySet metadata invalidation (updates)\r\n  // Currently, if the metadata changes we need to re-render the display set\r\n  // for it to take effect in the viewport. As we deal with scaling in the loading,\r\n  // we need to remove the old volume from the cache, and let the\r\n  // viewport to re-add it which will use the new metadata. Otherwise, the\r\n  // viewport will use the cached volume and the new metadata will not be used.\r\n  // Note: this approach does not actually end of sending network requests\r\n  // and it uses the network cache\r\n  useEffect(() => {\r\n    const { unsubscribe } = DisplaySetService.subscribe(\r\n      DisplaySetService.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,\r\n      async invalidatedDisplaySetInstanceUID => {\r\n        const viewportInfo = CornerstoneViewportService.getViewportInfoByIndex(\r\n          viewportIndex\r\n        );\r\n\r\n        if (viewportInfo.hasDisplaySet(invalidatedDisplaySetInstanceUID)) {\r\n          const viewportData = viewportInfo.getViewportData();\r\n          const newViewportData = await CornerstoneCacheService.invalidateViewportData(\r\n            viewportData,\r\n            invalidatedDisplaySetInstanceUID,\r\n            dataSource,\r\n            DisplaySetService\r\n          );\r\n\r\n          const keepCamera = true;\r\n          CornerstoneViewportService.updateViewport(\r\n            viewportIndex,\r\n            newViewportData,\r\n            keepCamera\r\n          );\r\n        }\r\n      }\r\n    );\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [viewportIndex]);\r\n\r\n  useEffect(() => {\r\n    // handle the default viewportType to be stack\r\n    if (!viewportOptions.viewportType) {\r\n      viewportOptions.viewportType = STACK;\r\n    }\r\n\r\n    const loadViewportData = async () => {\r\n      const viewportData = await CornerstoneCacheService.createViewportData(\r\n        displaySets,\r\n        viewportOptions,\r\n        dataSource,\r\n        initialImageIndex\r\n      );\r\n\r\n      CornerstoneViewportService.setViewportData(\r\n        viewportIndex,\r\n        viewportData,\r\n        viewportOptions,\r\n        displaySetOptions\r\n      );\r\n    };\r\n\r\n    loadViewportData();\r\n  }, [viewportOptions, displaySets, dataSource]);\r\n\r\n  /**\r\n   * There are two scenarios for jump to click\r\n   * 1. Current viewports contain the displaySet that the annotation was drawn on\r\n   * 2. Current viewports don't contain the displaySet that the annotation was drawn on\r\n   * and we need to change the viewports displaySet for jumping.\r\n   * Since measurement_jump happens via events and listeners, the former case is handled\r\n   * by the measurement_jump direct callback, but the latter case is handled first by\r\n   * the viewportGrid to set the correct displaySet on the viewport, AND THEN we check\r\n   * the cache for jumping to see if there is any jump queued, then we jump to the correct slice.\r\n   */\r\n  useEffect(() => {\r\n    const unsubscribeFromJumpToMeasurementEvents = _subscribeToJumpToMeasurementEvents(\r\n      MeasurementService,\r\n      DisplaySetService,\r\n      elementRef,\r\n      viewportIndex,\r\n      displaySets,\r\n      ViewportGridService,\r\n      CornerstoneViewportService\r\n    );\r\n\r\n    _checkForCachedJumpToMeasurementEvents(\r\n      MeasurementService,\r\n      DisplaySetService,\r\n      elementRef,\r\n      viewportIndex,\r\n      displaySets,\r\n      ViewportGridService,\r\n      CornerstoneViewportService\r\n    );\r\n\r\n    return () => {\r\n      unsubscribeFromJumpToMeasurementEvents();\r\n    };\r\n  }, [displaySets, elementRef, viewportIndex]);\r\n\r\n  return (\r\n    <div className=\"viewport-wrapper\">\r\n      <ReactResizeDetector\r\n        handleWidth\r\n        handleHeight\r\n        skipOnMount={true} // Todo: make these configurable\r\n        refreshMode={'debounce'}\r\n        refreshRate={200} // transition amount in side panel\r\n        onResize={onResize}\r\n        targetRef={elementRef.current}\r\n      />\r\n      <div\r\n        className=\"cornerstone-viewport-element\"\r\n        style={{ height: '100%', width: '100%' }}\r\n        onContextMenu={e => e.preventDefault()}\r\n        onMouseDown={e => e.preventDefault()}\r\n        ref={elementRef}\r\n      ></div>\r\n      <CornerstoneOverlays\r\n        viewportIndex={viewportIndex}\r\n        ToolBarService={ToolBarService}\r\n        element={elementRef.current}\r\n        scrollbarHeight={scrollbarHeight}\r\n        servicesManager={servicesManager}\r\n      />\r\n    </div>\r\n  );\r\n}, areEqual);\r\n\r\nfunction _subscribeToJumpToMeasurementEvents(\r\n  MeasurementService,\r\n  DisplaySetService,\r\n  elementRef,\r\n  viewportIndex,\r\n  displaySets,\r\n  ViewportGridService,\r\n  CornerstoneViewportService\r\n) {\r\n  const displaysUIDs = displaySets.map(\r\n    displaySet => displaySet.displaySetInstanceUID\r\n  );\r\n  const { unsubscribe } = MeasurementService.subscribe(\r\n    MeasurementService.EVENTS.JUMP_TO_MEASUREMENT,\r\n    ({ measurement }) => {\r\n      if (!measurement) return;\r\n\r\n      // Jump the the measurement if the viewport contains the displaySetUID (fusion)\r\n      if (displaysUIDs.includes(measurement.displaySetInstanceUID)) {\r\n        _jumpToMeasurement(\r\n          measurement,\r\n          elementRef,\r\n          viewportIndex,\r\n          MeasurementService,\r\n          DisplaySetService,\r\n          ViewportGridService,\r\n          CornerstoneViewportService\r\n        );\r\n      }\r\n    }\r\n  );\r\n\r\n  return unsubscribe;\r\n}\r\n\r\n// Check if there is a queued jumpToMeasurement event\r\nfunction _checkForCachedJumpToMeasurementEvents(\r\n  MeasurementService,\r\n  DisplaySetService,\r\n  elementRef,\r\n  viewportIndex,\r\n  displaySets,\r\n  ViewportGridService,\r\n  CornerstoneViewportService\r\n) {\r\n  const displaysUIDs = displaySets.map(\r\n    displaySet => displaySet.displaySetInstanceUID\r\n  );\r\n\r\n  const measurementIdToJumpTo = MeasurementService.getJumpToMeasurement(\r\n    viewportIndex\r\n  );\r\n\r\n  if (measurementIdToJumpTo && elementRef) {\r\n    // Jump to measurement if the measurement exists\r\n    const measurement = MeasurementService.getMeasurement(\r\n      measurementIdToJumpTo\r\n    );\r\n\r\n    if (displaysUIDs.includes(measurement.displaySetInstanceUID)) {\r\n      _jumpToMeasurement(\r\n        measurement,\r\n        elementRef,\r\n        viewportIndex,\r\n        MeasurementService,\r\n        DisplaySetService,\r\n        ViewportGridService,\r\n        CornerstoneViewportService\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nfunction _jumpToMeasurement(\r\n  measurement,\r\n  targetElementRef,\r\n  viewportIndex,\r\n  MeasurementService,\r\n  DisplaySetService,\r\n  ViewportGridService,\r\n  CornerstoneViewportService\r\n) {\r\n  const targetElement = targetElementRef.current;\r\n  const { displaySetInstanceUID, SOPInstanceUID, frameNumber } = measurement;\r\n\r\n  if (!SOPInstanceUID) {\r\n    console.warn('cannot jump in a non-acquisition plane measurements yet');\r\n  }\r\n\r\n  const referencedDisplaySet = DisplaySetService.getDisplaySetByUID(\r\n    displaySetInstanceUID\r\n  );\r\n\r\n  // Todo: setCornerstoneMeasurementActive should be handled by the toolGroupManager\r\n  //  to set it properly\r\n  // setCornerstoneMeasurementActive(measurement);\r\n\r\n  ViewportGridService.setActiveViewportIndex(viewportIndex);\r\n\r\n  const enableElement = getEnabledElement(targetElement);\r\n\r\n  const viewportInfo = CornerstoneViewportService.getViewportInfoByIndex(\r\n    viewportIndex\r\n  );\r\n\r\n  if (enableElement) {\r\n    // See how the jumpToSlice() of Cornerstone3D deals with imageIdx param.\r\n    const viewport = enableElement.viewport as IStackViewport | IVolumeViewport;\r\n\r\n    let imageIdIndex = 0;\r\n    let viewportCameraDirectionMatch = true;\r\n\r\n    if (viewport instanceof StackViewport) {\r\n      const imageIds = viewport.getImageIds();\r\n      imageIdIndex = imageIds.findIndex(imageId => {\r\n        const {\r\n          SOPInstanceUID: aSOPInstanceUID,\r\n          frameNumber: aFrameNumber,\r\n        } = getSOPInstanceAttributes(imageId);\r\n        return (\r\n          aSOPInstanceUID === SOPInstanceUID &&\r\n          (!frameNumber || frameNumber === aFrameNumber)\r\n        );\r\n      });\r\n    } else {\r\n      // for volume viewport we can't rely on the imageIdIndex since it can be\r\n      // a reconstructed view that doesn't match the original slice numbers etc.\r\n      const { viewPlaneNormal } = measurement.metadata;\r\n      imageIdIndex = referencedDisplaySet.images.findIndex(\r\n        i => i.SOPInstanceUID === SOPInstanceUID\r\n      );\r\n\r\n      const { orientation } = viewportInfo.getViewportOptions();\r\n\r\n      if (\r\n        orientation &&\r\n        viewPlaneNormal &&\r\n        !csUtils.isEqual(\r\n          CONSTANTS.MPR_CAMERA_VALUES[orientation]?.viewPlaneNormal,\r\n          viewPlaneNormal\r\n        )\r\n      ) {\r\n        viewportCameraDirectionMatch = false;\r\n      }\r\n    }\r\n\r\n    if (!viewportCameraDirectionMatch || imageIdIndex === -1) {\r\n      return;\r\n    }\r\n\r\n    cs3DTools.utilities.jumpToSlice(targetElement, {\r\n      imageIndex: imageIdIndex,\r\n    });\r\n\r\n    cs3DTools.annotation.selection.setAnnotationSelected(measurement.uid);\r\n    // Jump to measurement consumed, remove.\r\n    MeasurementService.removeJumpToMeasurement(viewportIndex);\r\n  }\r\n}\r\n\r\n// Component displayName\r\nOHIFCornerstoneViewport.displayName = 'OHIFCornerstoneViewport';\r\n\r\nOHIFCornerstoneViewport.propTypes = {\r\n  viewportIndex: PropTypes.number.isRequired,\r\n  displaySets: PropTypes.array.isRequired,\r\n  dataSource: PropTypes.object.isRequired,\r\n  viewportOptions: PropTypes.object,\r\n  displaySetOptions: PropTypes.arrayOf(PropTypes.any),\r\n  servicesManager: PropTypes.object.isRequired,\r\n  onElementEnabled: PropTypes.func,\r\n  // Note: you SHOULD NOT use the initialImageIdOrIndex for manipulation\r\n  // of the imageData in the OHIFCornerstoneViewport. This prop is used\r\n  // to set the initial state of the viewport's first image to render\r\n  initialImageIdOrIndex: PropTypes.oneOfType([\r\n    PropTypes.string,\r\n    PropTypes.number,\r\n  ]),\r\n};\r\n\r\nexport default OHIFCornerstoneViewport;\r\n"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","this","constructor","create","__rest","s","e","t","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","commonjsGlobal","globalThis","window","g","self","isObject_1","value","type","freeGlobal","freeSelf","root$2","Function","root$1","now_1","Date","now","reWhitespace","trimmedEndIndex","string","index","test","charAt","reTrimStart","_baseTrim","slice","replace","_Symbol","Symbol","Symbol$1","objectProto$1","nativeObjectToString$1","toString","symToStringTag$1","toStringTag","undefined","_getRawTag","isOwn","tag","unmasked","result","nativeObjectToString","getRawTag","objectToString","symToStringTag","baseGetTag","isObjectLike","baseTrim","isObject$2","isSymbol","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","isObject$1","toNumber","other","valueOf","isBinary","nativeMax","Math","max","nativeMin","min","debounce_1","func","wait","options","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","invokeFunc","time","args","thisArg","apply","leadingEdge","setTimeout","timerExpired","shouldInvoke","timeSinceLastCall","trailingEdge","timeWaiting","remainingWait","debounced","isInvoking","arguments","clearTimeout","cancel","flush","debounce","isObject","throttle_1","patchResizeHandler","resizeCallback","refreshMode","refreshRate","refreshOptions","isFunction","fn","isSSR","isDOMElement","element","Element","HTMLDocument","createNotifier","onResize","setSize","handleWidth","handleHeight","_a","width","height","prev","ResizeDetector","_super","props","_this","cancelHandler","resizeHandler","attachObserver","targetRef","observerOptions","current","getElement","observableElement","resizeObserver","observe","querySelector","targetDomEl","document","currentElement","findDOMNode","getRenderType","parentElement","createResizeHandler","entries","_b","_c","notifyResize","setState","bind","forEach","entry","contentRect","skipOnMount","render","children","isValidElement","isArray","state","createRef","ResizeObserver","componentDidMount","componentDidUpdate","componentWillUnmount","disconnect","typedChildren","nodeType","WrapperTag","childProps","nativeProps","cloneElement","map","el","PureComponent","useEffect","useLayoutEffect","CornerstoneImageScrollbar","viewportData","viewportIndex","imageSliceData","setImageSliceData","scrollbarHeight","servicesManager","services","CineService","CornerstoneViewportService","viewport","getCornerstoneViewportByIndex","viewportType","Enums","sliceData","utilities","imageIndex","numberOfSlices","getCurrentImageIdIndex","data","imageIds","updateStackIndex","event","newImageIdIndex","detail","addEventListener","removeEventListener","updateVolumeIndex","onChange","evt","viewportId","getViewportInfoByIndex","getViewportId","getCornerstoneViewport","getState","isCineEnabled","stopClip","setCine","id","isPlaying","csToolsUtils","debounceLoading","onImageScrollbarChange","propTypes","PropTypes","EPSILON","CornerstoneViewportOverlay","ToolBarService","useState","windowCenter","windowWidth","voi","setVOI","scale","setScale","activeTools","setActiveTools","getActiveTools","isMounted","unsubscribe","subscribe","EVENTS","TOOL_BAR_STATE_MODIFIED","updateVOI","eventDetail","range","lower","upper","updateScale","previousCamera","camera","parallelScale","imageData","getImageData","spacing","clientHeight","getTopLeftContent","useCallback","includes","className","toFixed","getTopRightContent","instanceNumber","imageId","metaData","get","_getInstanceNumberFromStack","volumes","volume","direction","cornerstoneViewport","viewPlaneNormal","getCamera","scanAxisNormal","cross","vec3","_getInstanceNumberFromVolume","ohifViewport","backgroundColor","getViewportOptions","background","isLight","topLeft","topRight","color","getOrientationStringLPS","invertOrientationStringLPS","ViewportOrientationMarkers","orientationMarkers","rotation","setRotation","flipHorizontal","setFlipHorizontal","flipVertical","setFlipVertical","cameraModifiedListener","markers","useMemo","rowCosines","columnCosines","getEnabledElement","viewUp","viewRight","rowString","columnString","oppositeRowString","top","left","right","bottom","_getOrientationMarkers","csUtils","m","classNames","key","percentComplete","error","defaultProps","ViewportImageSliceLoadingIndicator","loading","setLoading","setError","loadIndicatorRef","useRef","imageIdToBeLoaded","setLoadingState","setFinishLoadingState","setErrorState","setViewportData","VIEWPORT_DATA_CHANGED","viewportInfo","viewportOptions","customViewportProps","hideOverlays","ViewportImageScrollbar","ViewportOverlay","areEqual","prevProps","nextProps","needsRerendering","displaySets","orientation","toolGroupId","prevDisplaySets","nextDisplaySets","prevDisplaySet","foundDisplaySet","find","nextDisplaySet","displaySetInstanceUID","images","j","OHIFCornerstoneViewport","React","dataSource","displaySetOptions","onElementEnabled","onElementDisabled","initialImageIndex","setScrollbarHeight","elementRef","MeasurementService","DisplaySetService","ToolGroupService","SyncGroupService","CornerstoneCacheService","ViewportGridService","setImageScrollBarHeight","resize","cleanUpServices","renderingEngineId","getRenderingEngineId","syncGroups","getSyncGroups","removeViewportFromToolGroup","removeViewportFromSyncGroup","elementEnabledHandler","getViewportInfo","getViewportIndex","setEnabledElement","getToolGroupId","addViewportToToolGroup","addViewportToSyncGroup","enableViewport","eventTarget","disableElement","DISPLAY_SET_SERIES_METADATA_INVALIDATED","invalidatedDisplaySetInstanceUID","hasDisplaySet","getViewportData","invalidateViewportData","newViewportData","updateViewport","loadViewportData","createViewportData","unsubscribeFromJumpToMeasurementEvents","displaysUIDs","displaySet","JUMP_TO_MEASUREMENT","measurement","_jumpToMeasurement","_subscribeToJumpToMeasurementEvents","measurementIdToJumpTo","getJumpToMeasurement","getMeasurement","_checkForCachedJumpToMeasurementEvents","style","onContextMenu","preventDefault","onMouseDown","ref","targetElementRef","targetElement","SOPInstanceUID","frameNumber","console","warn","referencedDisplaySet","getDisplaySetByUID","setActiveViewportIndex","enableElement","imageIdIndex","viewportCameraDirectionMatch","StackViewport","getImageIds","findIndex","getSOPInstanceAttributes","aSOPInstanceUID","aFrameNumber","metadata","CONSTANTS","cs3DTools","uid","removeJumpToMeasurement","displayName","initialImageIdOrIndex"],"sourceRoot":""}